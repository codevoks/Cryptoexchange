FROM node:20-alpine

WORKDIR /app

# Copy root config and lockfiles
COPY package.json package-lock.json turbo.json .npmrc ./

# ðŸ‘‡ Workspaces bhi chahiye before install
COPY apps/ apps/
COPY packages/ packages/

# Install dependencies
RUN npm install --workspaces --legacy-peer-deps

# Build only ws-server
RUN npx turbo run build --filter=ws-server...

# Change working directory
WORKDIR /app/apps/ws-server

EXPOSE 8080

CMD ["npm", "run", "dev"]